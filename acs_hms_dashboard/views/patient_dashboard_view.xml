<?xml version='1.0' encoding='UTF-8'?>
<odoo>
    <record id="patient_dashboard_kanban_view" model="ir.ui.view">
        <field name="name">Patient Dashboard</field>
        <field name="model">hms.patient</field>
        <field name="type">kanban</field>
        <field name="priority">100</field>
        <field name="arch" type="xml">
            <kanban create="false" class="o_kanban_dashboard o_acs_hms_kanban">
                <field name="id"/>
                <field name="name"/>
                <field name="image_128"/>
                <field name="age"/>
                <field name="gender"/>
                <field name="primary_physician_id"/>
                <field name="parent_id"/>
                <field name="function"/>
                <field name="code"/>
                <field name="today_is_birthday"/>
                <field name="acs_tag_ids"/>
                <!-- <field name="total_patients"/>
                <field name="total_patients_color"/>
                <field name="total_appointments"/> -->
                <templates>
                    <t t-name="acs_dashboard_block">
                        <div t-attf-class="card acs-card card-acs" t-attf-style="border-color:#{acs_record_color}">
                            <a type="object" name="acs_open_dashboard_action"
                               t-attf-context="{'acs_action': '#{acs_record_action}' }">
                                <div class="card-heading"
                                     t-attf-style="border-color:#{acs_record_color}; background-color: #{acs_record_color};">
                                    <div class="row">
                                        <div class="col-3 stat-icon stat-icon">
                                            <i t-attf-class="fa #{acs_record_icon}" aria-label="Info" title="Info"></i>
                                        </div>
                                        <div class="col-9 text-right">
                                            <div class="value">
                                                <span t-esc="acs_field_name"/>
                                            </div>
                                            <div class="title">
                                                <t t-esc="acs_record_lable"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </a>
                            <a type="object" name="acs_open_dashboard_action"
                               t-attf-context="{'acs_action': '#{acs_record_action}' }"
                               t-attf-style="color: #{acs_record_color};">
                                <div class="card-footer acs-footer">
                                    <span class="float-start">View Details</span>
                                    <span class="float-end">
                                        <i class="fa fa-arrow-circle-right" aria-label="Info" title="Info"></i>
                                    </span>
                                    <div class="clearfix"></div>
                                </div>
                            </a>
                        </div>
                    </t>
                    <t t-name="acs_dashboard_block_second">
                        <div t-attf-class="card acs-card card-acs" t-attf-style="border-color:#{acs_record_color}">
                            <div class="card-heading"
                                 t-attf-style="border-color:#{acs_record_color}; background-color: #{acs_record_color};">
                                <div class="row">
                                    <div class="col-3 stat-icon">
                                        <i t-attf-class="fa #{acs_record_icon}" aria-label="Info" title="Info"></i>
                                    </div>
                                    <div class="col-9 text-right">
                                        <div class="row">
                                            <div class="col-6 text-center my-auto">
                                                <a type="object" name="acs_open_dashboard_action"
                                                   t-attf-context="{'acs_action': '#{acs_record_action}' }">

                                                    <div class="value big-acs-number">
                                                        <span t-esc="acs_field_name"/>
                                                    </div>
                                                    <div class="title small">
                                                        <t t-esc="acs_record_lable"/>
                                                    </div>
                                                </a>
                                            </div>
                                            <div class="col-6 text-center my-auto">
                                                <a type="object" name="acs_open_dashboard_action"
                                                   t-attf-context="{'acs_action': '#{acs_record2_action}' }">

                                                    <div class="value big-acs-number">
                                                        <span t-esc="acs_field2_name"/>
                                                    </div>
                                                    <div class="title small">
                                                        <t t-esc="acs_record2_lable"/>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                        <hr class="acs-hr"/>
                                        <div class="text-center title">
                                            <t t-esc="acs_lable"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-name="kanban-box">
                        <div id="acs_hms_dashboard" class="">
                            <!-- <div class="row">
                                <span t-esc="dashboard_data_filter"/>
                                <div class="btn-group col-4 mt8 mb8" role="group" aria-label="Filters">
                                    <button t-attf-class="btn #{record.dashboard_data_filter.raw_value=='today' ? 'btn-primary' : 'btn-secondary'}"
                                            type="object" name="today_data">Today
                                    </button>
                                    <button t-attf-class="btn #{record.dashboard_data_filter.raw_value=='week' ? 'btn-primary' : 'btn-secondary'}"
                                            type="object" name="week_data">This Week
                                    </button>
                                    <button t-attf-class="btn #{record.dashboard_data_filter.raw_value=='month' ? 'btn-primary' : 'btn-secondary'}"
                                            type="object" name="month_data">This Month
                                    </button>
                                    <button t-attf-class="btn #{record.dashboard_data_filter.raw_value=='all' ? 'btn-primary' : 'btn-secondary'}"
                                            type="object" name="all_data">Till Now
                                    </button>
                                </div>
                            </div> -->
                            <div class="row">
                                <!-- Total Patients -->
                                <div class="col-3 acs_block">
                                    <!-- <div 
                                        class="o_kanban_image_fill_left d-none d-md-block" 
                                        t-attf-style="background-image:url('#{kanban_image('hms.patient', 'image_128', record.id.raw_value, placeholder)}')"/> -->
                                    <t t-call="acs_dashboard_block">
                                        <!-- <t t-set="acs_record_color" t-value="record.total_patients_color.raw_value"/> -->
                                        <!-- <t t-set="acs_record_icon" t-value="'fa-bed'"/> -->
                                        <t t-set="acs_field_name" t-value="record.name.raw_value"/>
                                        <!-- <t t-set="acs_record_lable">Patients</t> -->
                                        <!-- <t t-set="acs_record_action" t-value="'open_patients'"/> -->
                                    </t>
                                </div>
                                <div class="col-3 acs_block">
                                    <t t-call="acs_dashboard_block_second">
                                        <!-- <t t-set="acs_record_color" t-value="record.physicians_color.raw_value"/> -->
                                        <!-- <t t-set="acs_record_icon" t-value="'fa-user-md'"/> -->
                                        <t t-set="acs_field_name" t-value="record.name.raw_value"/>
                                        <!-- <t t-set="acs_record_action" t-value="'open_physicians'"/> -->
                                        <!-- <t t-set="acs_record_lable">Total Phy.</t> -->
                                    </t>
                                </div>
                            </div>
                            <!-- <div class="row" id="appointment_list" groups="acs_hms.group_hms_receptionist">
                                <div class="col-6 mb32">
                                    <t t-value="JSON.parse(record.appointment_data.raw_value)"
                                       t-set="appointment_data"/>
                                    <div class="card">
                                        <h5 class="card-header">
                                            <a type="object" name="open_appointments">Appointments</a>
                                            <a href="#" title="This will show max 20 records only" class="o_doc_link"/>
                                        </h5>
                                        <div class="card-body p-0">
                                            <div class="table-responsive table-striped">
                                                <table class="table">
                                                    <thead class="bg-info">
                                                        <tr class="border-0">
                                                            <th class="border-0">#</th>
                                                            <th class="border-0">Appointment</th>
                                                            <th class="border-0">Patient</th>
                                                            <th class="border-0">Date</th>
                                                            <th class="border-0">Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-set="limit" t-value="0"></t>
                                                        <tr t-foreach="appointment_data" t-as="line">
                                                            <t t-if="limit &lt; 5">
                                                                <td><span t-esc="line_index + 1"/>.
                                                                </td>
                                                                <td>
                                                                    <a t-attf-href="/web#id={{ line.id }}&amp;model=hms.appointment&amp;view_type=form">
                                                                        <span t-esc="line.name"/>
                                                                    </a>
                                                                </td>
                                                                <td>
                                                                    <span t-esc="line.patient"/>
                                                                </td>
                                                                <td>
                                                                    <span t-esc="line.date"/>
                                                                </td>
                                                                <td>
                                                                    <span t-esc="line.state"/>
                                                                </td>
                                                                <t t-set="limit" t-value="limit + 1"></t>
                                                            </t>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6 mb32 online-prescriber">
                                    <div class="card">
                                        <h5 class="card-header">
                                            <a type="object" name="open_appointments">Online Prescriber</a>
                                            <a href="#" title="This will show max 20 records only" class="o_doc_link"/>
                                        </h5>
                                        <div class="card-body p-0">
                                            <div id="dashboard_prescribers">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                            <!-- Graphs -->
                            <!-- <div class="row" id="dashboard_graphs" groups="acs_hms.group_hms_receptionist">
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                    <div t-attf-class="card acs-card card-#{record.appointment_bar_graph_color.raw_value}">
                                        <div class="card-heading">
                                            <i class="fa fa-area-chart" aria-label="Info" title="Info"></i>
                                            Patient Appointments
                                        </div>
                                        <div class="card-body o_acs_dashboard_graph">
                                            <t t-name="JournalBodyGraph">
                                                <field name="appointment_bar_graph" graph_type="bar"
                                                       widget="dashboard_graph"/>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                                    <div t-attf-class="card acs-card card-#{record.patient_line_graph_color.raw_value}">
                                        <div class="card-heading">
                                            <i class="fa fa-area-chart" aria-label="Info" title="Info"></i>
                                            New Patients
                                        </div>
                                        <div class="card-body o_acs_dashboard_graph">
                                            <t t-name="JournalBodyGraph">
                                                <field name="patient_line_graph" graph_type="line"
                                                       widget="dashboard_graph"/>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                        <div id="loading"><div class="loading-container"><span class="loader"></span></div></div>
                        <script type="text/javascript">
                            <!-- check is device small null true => windows -->
                            if (Object.is(document.querySelector("div.MessagingMenuContainer > .o-isDeviceSmall"), null)) {
                                call_telehealth_dashboard();
                            } else {
                                <!-- mobile -->
                                call_telehealth_dashboard_mobile();
                            }
 
                            clone_telehealth_dashboard();
                            close_telehealth();
                            
                            setTimeout(() => {
                                $('#dashboard_prescribers .o_ChannelMember').on('click', function() {
                                    console.log("imhere============ if ok");
                                    var self = $(this);
                                    var prescriber_id = self.data('partner-id');
                                    call_telehealth_dashboard();
                                
                                    setTimeout(() => {
                                        $('.o_ChatWindow div[data-partner-id="'+prescriber_id+'"]').click();
                    
                                        var style = document.createElement('style');
                                        style.innerHTML = `
                                        .o_ChatWindow {
                                          opacity: 1 !important;
                                          z-index: 9999 !important;
                                        }
                                        `;
                                        document.head.appendChild(style);
                    
                                        call_close_chatbox();
                    
                                
                                    }, 1500);
                                })
                        
                            }, 1500);
                        </script>
                        <style type="text/css">
                            .position-absolute {
                                position: absolute !important;
                                height: 100% !important;
                                width: 50% !important;
                            }
                    
                            @media only screen and (max-width: 768px) {
                                .position-absolute {
                                    position: absolute !important;
                                    height: 100% !important;
                                    width: 70% !important;
                                }
                            }
                    
                    
                            .o_MessagingMenu_dropdownMenu {
                                z-index: -1;
                                opacity: 0;
                            }
                    
                            .o_ChatWindow {
                                opacity: 0;
                                z-index: -1;
                            }
                        </style>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    <record id="action_patient_dashboard" model="ir.actions.act_window">
        <field name="name">Patient Dashboard</field>
        <field name="res_model">hms.patient</field>
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="patient_dashboard_kanban_view"/>
        <field name="usage">menu</field>
        <!-- <field name="domain">[('id','=',uid)]</field> -->
    </record>
    <menuitem id="patient_dashboard_menu" name="Patient Dashboard" parent="main_dashboard"
              action="action_patient_dashboard" sequence="10"/>

</odoo>